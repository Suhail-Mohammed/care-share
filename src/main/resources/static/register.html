<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Care & Share â€” Register</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />

    <style>
        /* Your existing styles */
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        html, body {
          background: rgba(6, 20, 29, 0.85);
          height: 100%;
          margin: 0;
        }
        body {
          height: 100vh;
          display: flex;
          justify-content: center;
          align-items: center;
          background: url('https://images.unsplash.com/photo-1521791136064-7986c2920216?auto=format&fit=crop&w=1350&q=80') no-repeat center center/cover;
          position: relative;
        }
        body::before {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(6, 20, 29, 0.85);
          z-index: 0;
        }
        .register-box {
          position: relative;
          z-index: 1;
          width: 450px;
          max-height: 90vh;
          overflow-y: auto;
          background: rgba(0, 0, 0, 0.6);
          box-shadow: 0 0 30px rgba(40, 167, 69, 0.4);
          padding: 30px 30px;
          border-radius: 12px;
          color: #fff;
          box-sizing: border-box;
        }
        .register-box h2 {
          font-size: 26px;
          margin-bottom: 30px;
          text-align: center;
          color: #28a745;
        }
        .input-box {
          position: relative;
          margin-bottom: 25px;
        }
        .input-box input {
          width: 100%;
          padding: 16px 50px 16px 16px;
          border: none;
          outline: none;
          border-radius: 8px;
          background: #142733;
          color: #fff;
          font-size: 16px;
          transition: 0.3s;
        }
        .input-box input:focus {
          box-shadow: 0 0 10px #28a745;
        }
        .input-box i {
          position: absolute;
          right: 16px;
          top: 50%;
          transform: translateY(-50%);
          color: #aaa;
          font-size: 18px;
        }
        .btn {
          width: 100%;
          padding: 16px;
          border: none;
          border-radius: 25px;
          background: linear-gradient(135deg, #28a745, #218838);
          color: #fff;
          font-weight: bold;
          font-size: 17px;
          cursor: pointer;
          margin-top: 15px;
          transition: 0.3s;
        }
        .btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 0 15px rgba(40, 167, 69, 0.7);
        }
        .signup {
          margin-top: 20px;
          font-size: 15px;
          text-align: center;
        }
        .signup a {
          color: #28a745;
          text-decoration: none;
        }
        .feedback {
          font-size: 0.95rem;
          margin-top: 4px;
        }
        /* Scrollbar styling for WebKit browsers */
        .register-box::-webkit-scrollbar {
          width: 8px;
        }
        .register-box::-webkit-scrollbar-track {
          background-color: rgba(6, 20, 29, 0.85);
        }
        .register-box::-webkit-scrollbar-thumb {
          background-color: #218838;
          border-radius: 10px;
        }
        .register-box::-webkit-scrollbar-thumb:hover {
          background-color: #28a745;
        }
        @media (max-width: 500px) {
          .register-box {
            width: 90vw;
            padding: 20px 15px;
          }
        }
    </style>
</head>
<body>
<div class="register-box">
    <h2>Register</h2>

    <form id="registerForm" novalidate>
        <div class="input-box">
            <input id="firstName" name="firstName" type="text" placeholder="First Name" required />
            <i class="bi bi-person-fill"></i>
        </div>
        <div class="input-box">
            <input id="lastName" name="lastName" type="text" placeholder="Last Name" required />
            <i class="bi bi-person-fill"></i>
        </div>
        <div class="input-box">
            <input id="phone" name="phone" type="text" maxlength="10" placeholder="Phone Number (10 digits)" required />
            <i class="bi bi-telephone-fill"></i>
            <div id="phoneFeedback" class="feedback"></div>
        </div>
        <div class="input-box">
            <input id="email" name="email" type="email" placeholder="Email Address" required />
            <i class="bi bi-envelope-fill"></i>
        </div>
        <div class="input-box">
            <input id="password" name="password" type="password" placeholder="Password" required />
            <i class="bi bi-lock-fill"></i>
        </div>
        <div class="input-box">
            <input id="confirmPassword" name="confirmPassword" type="password" placeholder="Confirm Password" required />
            <i class="bi bi-lock-fill"></i>
            <div id="passwordMatchFeedback" class="feedback"></div>
        </div>

        <button class="btn" type="submit">Register</button>
    </form>

    <div class="signup">
        Already have an account? <a href="login.html">Login</a>
    </div>
</div>

<!-- Bootstrap Modal for success -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-0">
                <h5 class="modal-title" id="successModalLabel">Registration Successful</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="successModalBody">
                <!-- Success message will be inserted here -->
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-primary" id="modalOkBtn">OK</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const showAlert = (message, type = 'success') => {
      // fallback alert removed, using modal for success only
      console.log(message);
    };

    const phoneInput = document.getElementById('phone');
    const phoneFeedback = document.getElementById('phoneFeedback');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const passwordMatchFeedback = document.getElementById('passwordMatchFeedback');
    const registerForm = document.getElementById('registerForm');
    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
    const modalOkBtn = document.getElementById('modalOkBtn');
    const successModalBody = document.getElementById('successModalBody');

    phoneInput.addEventListener('input', function () {
      this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);
      if (this.value.length !== 10) {
        phoneFeedback.textContent = 'Enter a valid 10-digit phone number';
        phoneFeedback.className = 'feedback text-danger';
      } else {
        phoneFeedback.textContent = 'âœ… Valid phone number';
        phoneFeedback.className = 'feedback text-success';
      }
    });

    function checkPasswordMatch() {
      if (!confirmPasswordInput.value) {
        passwordMatchFeedback.textContent = '';
        return;
      }
      if (passwordInput.value === confirmPasswordInput.value) {
        passwordMatchFeedback.textContent = 'âœ… Passwords match';
        passwordMatchFeedback.className = 'feedback text-success';
      } else {
        passwordMatchFeedback.textContent = 'âŒ Passwords do not match';
        passwordMatchFeedback.className = 'feedback text-danger';
      }
    }

    passwordInput.addEventListener('input', checkPasswordMatch);
    confirmPasswordInput.addEventListener('input', checkPasswordMatch);

    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (phoneInput.value.length !== 10) {
        alert('âŒ Please enter a valid 10-digit phone number.');
        phoneInput.focus();
        return;
      }

      if (passwordInput.value !== confirmPasswordInput.value) {
        alert('âŒ Passwords do not match.');
        confirmPasswordInput.focus();
        return;
      }

      const payload = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        phone: phoneInput.value,
        email: document.getElementById('email').value,
        password: passwordInput.value
      };

      try {
        const res = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const text = await res.text();
          alert('âŒ Registration failed: ' + text);
          return;
        }

        const data = await res.json();
        successModalBody.innerText = `ðŸŽ‰ Successfully registered with email: ${data.email || payload.email}`;
        successModal.show();

      } catch (err) {
        alert('âš ï¸ Network error: ' + err.message);
      }
    });

    modalOkBtn.addEventListener('click', () => {
      successModal.hide();
      window.location.href = '/login.html';
    });
</script>
</body>
</html>
